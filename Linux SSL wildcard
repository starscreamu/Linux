mkdir -p /etc/ssl/adcs

cd /etc/ssl/adcs

openssl genrsa -out private.key 2048

nano openssl.conf

[req]
default_bits = 2048
prompt = no
default_md = sha256
req_extensions = req_extensions
distinguished_name = dn

[dn]
C=RU
ST=SPb
L=SPb
O=Global Security
OU=IT Department
emailAddress=hostmaster@starscream.ru #change
CN = *.starscream.local #change

[req_extensions]
subjectAltName = @alter_name

[alter_name]
DNS.1 = *.starscream.local #change


openssl req -new -key private.key -out request.csr -config openssl.conf

Move request.csr to Windows

On Windows:

http://192.168.0.15/certsrv/

Move the file .cer to Linux

openssl x509 -inform der -in certnew.cer -out public.pem #convert to .pem

2 files:
private.key 
public.pem 

nano /etc/nginx/sites-available/default

upstream backend { 
 server 192.168.100.100:8080 fail_timeout=25; 
 server 172.16.100.100:8080 fail_timeout=25; 
} 
 
server { 
    listen 443 ssl; 
    include snippers/snakeoil.conf;

    server_name www.starscream.com; 

 location / { 
  proxy_pass http://backend ; 
 } 
}

server { 
   listen 80  default_server; 
   server_name _; 
   

}

NGINX config check - include sites-available path if needed

nano /etc/nginx/snippets/snakeoil.conf

include ssl_certificate /etc/ssl/adcs/public.pem
Include ssl_certificate_key /etc/ssl/adcs/private.key



[ ca ]
default_ca      = CA_default

[ CA_default ]

dir             = /etc/ssl/hqwork
certs           = $dir/certs
crl_dir         = $dir/crl
database        = $dir/index.txt

new_certs_dir   = $dir/newcerts

certificate     = $dir/cacert.pem
serial          = $dir/serial
crlnumber       = $dir/crlnumber

crl             = $dir/crl.pem
private_key     = $dir/private/cakey.pem

x509_extensions = usr_cert

name_opt        = ca_default
cert_opt        = ca_default



default_days    = 3650
default_crl_days= 30
default_md      = default
preserve        = no

policy          = policy_match

[ policy_match ]
countryName     = match
stateOrProvinceName     = match
organizationName        = match
organizationalUnitName  = optional
commonName      = supplied
emailAddress    = optional

[req]
default_bits = 2048
prompt = no
default_md = sha256
req_extensions = req_extensions
distinguished_name = dn

[dn]
C=RU
ST=SPb
L=SPb
O=Global Security
OU=IT Department
emailAddress=hostmaster@starscream.ru

[ usr_cert ]
basicConstraints=CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer
subjectAltName = @alter_name

[alter_name]
DNS.1 = *.hq.work


